<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Dragon's MapTool Macros</title>
  <link rel="stylesheet" href="style.css">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
</head>

<body>
  <header>
    <!-- Background image -->
    <div id="backgroundimage">
      <div class="d-flex justify-content-center align-items-center h-100">
        <div id="headertitle">
          <h1>Dragon's MapTool Macro Library</h1>
        </div>
      </div>
    </div>
    <!-- Background image -->
  </header>

  <main>
    <div id="settings-bar" class="d-flex justify-content-start align-items-center">
      <input type="text" id="search-input" class="form-control" placeholder="Search for tables...">
    </div>
    <h1>DnD Macros</h1>
    <ul id="macros-list"></ul>
  </main>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
    crossorigin="anonymous"></script>

  <script>
    async function fetchData() {
      try {
        // Fetch the JSON data from the macros.json file
        const macrosResponse = await fetch('macros.json');
        if (!macrosResponse.ok) {
          throw new Error('Network response was not ok ' + macrosResponse.statusText);
        }
        const macros = await macrosResponse.json();

        // Get the element with the ID macros-list
        const macrosList = document.getElementById('macros-list');

        // Clear any existing content in the macros-list
        macrosList.innerHTML = '';

        // Variable to keep track of the currently open item
        let currentlyOpenItem = null;

        // Iterate over each macro item in the JSON data
        macros.forEach(macro => {
          // Create a list item (li) for each macro
          const li = document.createElement('li');
          li.className = 'macro-item'; // Add class for styling

          // Set the inner HTML of the list item, excluding category and subcategory
          li.innerHTML = `
              <h3>${macro.name}</h3>
              <div class="macro-details">
                <p><strong>Description:</strong> ${macro.description}</p>
                <p><strong>Macro Code:</strong> ${macro.macrocode}</p>
              </div>
            `;

          // Add click event listener to toggle the display of macro details
          li.addEventListener('click', () => {
            const details = li.querySelector('.macro-details');

            // Check if the clicked item is already open
            if (details.classList.contains('open')) {
              details.classList.remove('open');
              currentlyOpenItem = null;
            } else {
              // Close any other open items
              if (currentlyOpenItem) {
                currentlyOpenItem.classList.remove('open');
              }

              // Open the current item
              details.classList.add('open');
              currentlyOpenItem = details;
            }
          });

          // Append the list item to the macros-list
          macrosList.appendChild(li);
        });

        // Search functionality
        const searchInput = document.getElementById('search-input');
        searchInput.addEventListener('input', () => {
          const query = searchInput.value.toLowerCase();
          const items = document.querySelectorAll('.macro-item');
          items.forEach(item => {
            const name = item.querySelector('h3').textContent.toLowerCase();
            if (name.includes(query)) {
              item.style.display = '';
            } else {
              item.style.display = 'none';
            }
          });
        });

      } catch (error) {
        console.error('Fetch error: ', error);
      }
    }

    // Call the fetchData function to fetch and display the data
    fetchData();
  </script>


</body>

</html>